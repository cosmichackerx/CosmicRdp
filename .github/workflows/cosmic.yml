name: AvicaRDP

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'  # Restart every 6 hours

jobs:
  avica_rdp:
    name: Start Avica RDP Session
    runs-on: windows-latest
    timeout-minutes: 350

    steps:
      - name: Download Required Files
        run: |
          Write-Host "Downloading scripts and Avica installer..."
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/setup.py" -OutFile "setup.py"
          Invoke-WebRequest -Uri "https://download.avica.com/AvicaLite_v8.0.8.9.exe" -OutFile "Avica_setup.exe"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/show.bat" -OutFile "show.bat"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/loop.bat" -OutFile "loop.bat"

      - name: Install Python Packages
        run: |
          python -m pip install --quiet requests pyautogui telegraph

      - name: Enable Remote Desktop & Set Password
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          net user runneradmin TheDisa1a

      - name: Start Avica & Run Setup
        run: |
          Write-Host "Launching Avica setup..."
          Start-Process "Avica_setup.exe"
          Start-Sleep -Seconds 10
          python setup.py

      - name: Show Connection Instructions
        run: |
          Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          Write-Host "â•‘        AVICA RDP CONNECTION          â•‘"
          Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          Write-Host ""
          Write-Host "  ğŸ“± WhatsApp: +923460257488"
          Write-Host "  ğŸ‘¨â€ğŸ’» Created by USMAN PASHA AKA H4K3R"
          Write-Host ""
          Write-Host "  ğŸ“‹ Instructions:"
          Write-Host "  â€¢ Go to the GoFile link that will appear below"
          Write-Host "  â€¢ Get Avica ID and Password from there"
          Write-Host "  â€¢ Download Avica app and connect"
          Write-Host "  â€¢ GoFile link changes every time!"
          Write-Host ""
          Write-Host "  â³ Waiting for GoFile link..."

      - name: Start Avica Service
        run: cmd /c show.bat

      - name: Keep Session Active
        run: |
          Write-Host "Avica is starting... Waiting for connection info."
          cmd /c loop.bat
